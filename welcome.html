<script>
  const apiUrl   = "https://creatorcore-api.vercel.app/api/getPlan";
  const emailEl  = document.getElementById("email");
  const btn      = document.getElementById("login");
  const errorDiv = document.getElementById("error");

  // 1) Define your dev emails
  const DEV_IDS = [
    "elijermartinez222@gmail.com",
    "mambertinez@gmail.com"
  ];

  // 2) Utility to check if this user is a dev
  function isDevUser(email) {
    return DEV_IDS.includes(email) || location.search.includes("dev=true");
  }

  // 3) Fetch the real plan only if not a dev
  async function fetchPlan(email) {
    const resp = await fetch(apiUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });
    if (!resp.ok) {
      const text = await resp.text();
      console.error("getPlan error detail:", text);
      throw new Error("We couldn't verify your plan right now. Please try again later.");
    }
    const { plan } = await resp.json();
    return plan;
  }

  btn.addEventListener("click", async () => {
    errorDiv.style.display = "none";
    const email = emailEl.value.trim().toLowerCase();
    if (!email) {
      errorDiv.textContent = "Please enter your email.";
      errorDiv.style.display = "block";
      return;
    }

    btn.disabled    = true;
    btn.textContent = "Verifyingâ€¦";

    try {
      let plan;
      if (isDevUser(email)) {
        // Devs automatically get lifetime
        plan = "lifetime";
      } else {
        plan = await fetchPlan(email);
        if (!plan || plan === "free") {
          errorDiv.textContent = "No active paid plan found for this email.";
          errorDiv.style.display = "block";
          btn.disabled    = false;
          btn.textContent = "Continue";
          return;
        }
      }

      localStorage.setItem("cc_user", email);
      localStorage.setItem("cc_plan", plan);

      window.location.href = "index.html";
    } catch (err) {
      errorDiv.textContent = err.message;
      errorDiv.style.display = "block";
      console.error("Welcome page error:", err);
      btn.disabled    = false;
      btn.textContent = "Continue";
    }
  });
</script>
