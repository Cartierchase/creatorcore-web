<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CreatorCore AI Demo</title>
  <script async src="https://tally.so/widgets/embed.js"></script>
  <style>
    body { font-family:sans-serif; padding:2rem; background:#f9f9f9 }
    nav { text-align:center; margin-bottom:1rem }
    img.logo { max-width:200px; display:block; margin:0 auto 1rem }
    .container {
      max-width:600px; margin:auto; background:#fff; padding:2rem;
      border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1); margin-bottom:2rem
    }
    label { font-weight:bold; margin-top:1rem; display:block }
    select,input,button,pre {
      display:block; width:100%; margin:.5rem 0; padding:.5rem;
      border:1px solid #ddd; border-radius:4px
    }
    button { background:#0066ff; color:#fff; border:none; cursor:pointer }
    pre { background:#f0f0f0; white-space:pre-wrap; padding:1rem; min-height:4em }
  </style>
</head>
<body>

  <!-- Logo & Banner -->
  <img class="logo" src="logo.png" alt="CreatorCore AI Logo"/>
  <img src="banner.png" alt="CreatorCore AI Banner"/>

  <!-- Nav -->
  <nav><a href="index.html">Demo</a> | <a href="pricing.html">Pricing</a></nav>

  <!-- Dev Mode Plan Selector -->
  <div id="planSelector" class="container" style="display:none;">
    <label for="userPlan">Your Plan (Dev Mode)</label>
    <select id="userPlan">
      <option value="free">Free</option>
      <option value="creator">Creator</option>
      <option value="pro">Pro</option>
      <option value="lifetime">Lifetime</option>
    </select>
  </div>

  <!-- HookBrain Module -->
  <div class="container">
    <h2>HookBrain</h2>
    <!-- (same dropdowns & inputs as before) -->
    <button id="generateCaptions">Generate HookBrain Content</button>
    <pre id="hookbrainOutput">Your HookBrain output…</pre>
  </div>

  <!-- CourseForge Module -->
  <div class="container">
    <h2>CourseForge (Life Coaching / Mastercourse)</h2>
    <!-- (same dropdowns as before) -->
    <button id="generateCourse">Generate CourseForge Content</button>
    <pre id="courseOutput">Your CourseForge output…</pre>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const email = localStorage.getItem("cc_user") || "";
    const plan  = localStorage.getItem("cc_plan") || "free";
    const DEV_IDS = ["dev@yourdomain.com"];
    const isDev = DEV_IDS.includes(email) || location.search.includes("dev=true");
    if (isDev) {
      document.getElementById("planSelector").style.display = "block";
      document.getElementById("userPlan").value = plan;
    }
    function getPlan(){ return isDev ? document.getElementById("userPlan").value : plan }

    async function postData(url, body){
      const res = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type":"application/json",
          "X-User-Plan": getPlan(),
          "X-User-Id":   email
        },
        body: JSON.stringify(body)
      });
      const text = await res.text();
      if (!res.ok) {
        let msg;
        try{ msg = JSON.parse(text).error }
        catch{ msg = text }
        throw new Error(msg || res.status);
      }
      return JSON.parse(text);
    }

    // HookBrain handler (unchanged)
    document.getElementById("generateCaptions").onclick = async () => {
      /* … existing HookBrain code … */
    };

    // ←—— CHANGED: CourseForge handler now unwraps nested JSON and parses sections
    document.getElementById("generateCourse").onclick = async () => {
      const payload = {
        topic:    document.getElementById("cfTopic").value,
        audience: document.getElementById("cfAudience").value,
        format:   document.getElementById("cfFormat").value,
        level:    document.getElementById("cfLevel").value
      };
      const out = document.getElementById("courseOutput");
      out.textContent = "Generating…";

      try {
        let { courseMarkdown } = await postData(
          "https://creatorcore-api.vercel.app/api/courseforge",
          payload
        );

        // **UNWRAP** if courseMarkdown itself is a JSON string
        let md = courseMarkdown.trim();
        if (md.startsWith("{")) {
          try {
            const inner = JSON.parse(md);
            if (inner.courseMarkdown) md = inner.courseMarkdown;
          } catch {}
        }

        // **PARSE & RENDER** into clean, labeled sections
        const lines = md.split("\n");
        const sections = [];
        let label = "", buffer = [];

        function flush() {
          if (!label) return;
          const isList = buffer.some(l => l.startsWith("- "));
          const body = isList
            ? `<ul>${ buffer.map(l=>`<li>${l.slice(2)}</li>`).join("") }</ul>`
            : buffer.map(l=>`<p>${l}</p>`).join("");
          sections.push(`<div><strong>${label}</strong>${body}</div>`);
          buffer = [];
        }

        lines.forEach(l => {
          if (l.startsWith("## **Course Title:")) {
            flush(); label = "Course Title:"; buffer.push(l.replace(/## \*\*Course Title:\*\*\s*/, ""));
          }
          else if (l.startsWith("### **Subtitle:")) {
            flush(); label = "Subtitle:"; buffer.push(l.replace(/### \*\*Subtitle:\*\*\s*/, ""));
          }
          else if (l.startsWith("## Sales Page Blurb")) {
            flush(); label = "Sales Page Blurb:";
          }
          else if (l.startsWith("## Modules & Lessons")) {
            flush(); label = "Modules & Lessons:";
          }
          else if (l.startsWith("## Workbook Exercises per Lesson")) {
            flush(); label = "Workbook Exercises per Lesson:";
          }
          else if (l.startsWith("## Downloadable Resources List")) {
            flush(); label = "Downloadable Resources List:";
          }
          else if (l.startsWith("## CTA & Next Steps")) {
            flush(); label = "CTA & Next Steps:";
          }
          else {
            if (l.trim()) buffer.push(l.trim());
          }
        });
        flush();

        out.innerHTML = sections.join("<hr/>");
      } catch (e) {
        out.textContent = "Error: " + e.message;
      }
    };
    // —— END CHANGED BLOCK

  });
  </script>

</body>
</html>
